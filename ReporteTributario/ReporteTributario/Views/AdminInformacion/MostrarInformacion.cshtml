@model IEnumerable<ReporteTributario.Models.ViewModels.InformacionBaseVM>

@section Styles {
    <!-- Bootstrap-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous" />
    <!-- DataTable -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
          integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <link href="~/css/admininfo/admininfo.css" rel="stylesheet" />
}
    <div class="container my-4">
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                <table id="datatable" class="table table-striped">
                    <caption>
                        DataTable.js Demo
                    </caption>
                    <thead>
                        <tr>

                            <th class="centered">Accion</th>
                            <th class="centered">Impuesto</th>
                            <th class="centered">Ciudad</th>
                            <th class="centered">Departamento</th>
                            <th class="centered">FechaLimite</th>
                            <th class="centered">Responsable</th>
                            <th class="centered">Periodo</th>
                            <th class="centered">Periodicidad</th>
                            <th class="centered">#</th>
                            <th class="centered">#</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody_users"></tbody>
                </table>
            </div>
        </div>
    </div>

    @section scripts {
        <!-- Bootstrap-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
        <!-- jQuery -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <!-- DataTable -->
        <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
        <!-- Custom JS -->
        @* <script src="~/js/admininfo/admininfo.js"></script> *@

    <script>

        let urlConsulta = "http://localhost:5195/api/ApiInformacion";
        let dataTable;
        let dataTableIsInitialized = false;

        const dataTableOptions = {
            //scrollX: "2000px",
            lengthMenu: [5, 10, 15, 20, 100, 200, 500],
            columnDefs: [
                { className: "centered", targets: [0, 1, 2, 3, 4, 5, 6] },
                { orderable: false, targets: [5, 6] },
                { searchable: false, targets: [1] }
                //{ width: "50%", targets: [0] }
            ],
            pageLength: 10,
            destroy: true,
            language: {
                lengthMenu: "Mostrar _MENU_ registros por página",
                zeroRecords: "Ningún usuario encontrado",
                info: "Mostrando de _START_ a _END_ de un total de _TOTAL_ registros",
                infoEmpty: "Ningún usuario encontrado",
                infoFiltered: "(filtrados desde _MAX_ registros totales)",
                search: "Buscar:",
                loadingRecords: "Cargando...",
                paginate: {
                    first: "Primero",
                    last: "Último",
                    next: "Siguiente",
                    previous: "Anterior"
                }
            }
        };

        const initDataTable = async () => {
            if (dataTableIsInitialized) {
                dataTable.destroy();
            }

            await listDatos();

            dataTable = $("#datatable").DataTable(dataTableOptions);

            dataTableIsInitialized = true;
        };

        const listDatos = async () => {
            try {
                const response = await fetch(urlConsulta);
                const datos = await response.json();

                console.log(datos)

                let content = datos.map(datos => `
                                        <tr>
                                            <td>${datos.IdImpuesto}</td>
                                            <td>${datos.Impuesto}</td>
                                            <td>${datos.Ciudad}</td>
                                            <td>${datos.Departamento}</td>
                                            <td>${datos.Responsable}</td>
                                            <td>${datos.FechaLimite}</td>
                                            <td>${datos.Periodo}</td>
                                            <td>${datos.Periodicidad}</td>
                                            <td><i class="fa-solid fa-check" style="color: green;"></i></td>
                                            <td>
                                                <button class="btn btn-sm btn-primary"><i class="fa-solid fa-pencil"></i></button>
                                                <button class="btn btn-sm btn-danger"><i class="fa-solid fa-trash-can"></i></button>
                                            </td>
                                        </tr>`).join('');

                tableBody_users.innerHTML = content;
            } catch (ex) {
                alert(ex);
            }
        };

        window.addEventListener("load", async () => {
            await initDataTable();
        });

    </script>
    }

    

 

